<ion-content *ngIf="picsLoaded" #chatContainer>
  <div *ngIf="this.chats.length < 1" class="noChats">
    <p>
      Sorry, looks like you don't have any chats yet. Head to the catch tab to find
      someone new!
    </p>

    <div class="fish" (click)="goToCatch()">
      <img name="fish" src="/assets/singlefish-orange.png" />

      <h1>Catch</h1>
    </div>
  </div>

  <ion-row>
    <ng-container *ngIf="matches">
      <ion-item detail="false" #matchesButton button (click)="presentMatches()">
        <ion-avatar slot="start">
          <img
            *ngFor="let match of matches.slice(0, 3); index as j"
            [ngStyle]="{
              zIndex: j,
              'margin-left': 3 * j + 'vh',
              position: 'absolute',
              width: 9 + 'vh',
              height: 9 + 'vh'
            }"
            [src]="(chatboardPictures$ | async)[match?.recipient?.uid]"
            class="match-image"
          />
        </ion-avatar>

        <div
          *ngIf="matches.length > 1 && matches.length < 10"
          class="text-container"
          id="match-text"
          [ngStyle]="styleFromMatches()"
        >
          {{ matches.length }} new catches!
        </div>

        <div
          *ngIf="matches.length === 1"
          class="text-container"
          id="match-text"
          [ngStyle]="styleFromMatches()"
        >
          {{ matches.length }} new catch!
        </div>

        <div
          *ngIf="matches.length >= 10"
          class="text-container"
          id="match-text"
          [ngStyle]="styleFromMatches()"
        >
          10+ new catches!
        </div>

        <img class="fish-back" src="/assets/nemo.png" />
      </ion-item>
    </ng-container>
  </ion-row>

  <ion-list *ngIf="this.chats.length > 0">
    <ion-item-sliding class="parent" *ngFor="let chat of chats; index as i">
      <ion-item detail="true" button (click)="goToMessenger(chat.id)">
        <ion-avatar slot="start">
          <img [src]="(chatboardPictures$ | async)[chat?.recipient?.uid]" />
        </ion-avatar>
        <div class="text-container">
          <ion-label
            color="primary"
            class="text-container name"
            [style.fontWeight]="
              chat?.recentMessage?.senderID === chat?.recipient?.uid ? 'bold' : 'normal'
            "
            [style.color]="
              chat?.recentMessage?.senderID === chat?.recipient?.uid
                ? 'var(--ion-color-primary)'
                : 'var(--ion-color-primary-tint)'
            "
          >
            {{ chat?.recipient?.name }}</ion-label
          >
          <ion-label
            color="black"
            class="text-container chat"
            id="lastMessage"
            *ngIf="chat?.recentMessage?.senderID === chat?.recipient?.uid"
          >
            {{
              shorten(chat?.recipient?.name + ": " + chat?.recentMessage?.content)
            }}</ion-label
          >
          <ion-label
            color="black"
            class="text-container chat"
            id="lastMessage"
            *ngIf="chat?.recentMessage?.senderID !== chat?.recipient?.uid"
          >
            {{ shorten("You: " + chat?.recentMessage?.content) }}</ion-label
          >
          <!-- <span> {{ getDate(chat.messages[chat.messages.length - 1].time) }}</span> -->
        </div>
        <ion-badge
          *ngIf="chat?.recentMessage?.senderID === chat?.recipient?.uid"
          id="unread-badge"
        >
          Your turn!
        </ion-badge>
      </ion-item>

      <!--Swipe across to delete options-->
      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="deleteChat($event, chat)">
          <ion-icon slot="icon-only" name="trash"></ion-icon>
        </ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>
</ion-content>
