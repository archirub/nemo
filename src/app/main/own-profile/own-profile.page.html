<ng-container *ngIf="!(picsLoaded$ | async)">
  <div class="fishAnim">
    <div class="flexcol">
      <img src="/assets/nemo_load.svg" #fish />
      <h2>Loading your profile</h2>
    </div>
  </div>
</ng-container>

<ion-content *ngIf="picsLoaded$ | async" #profileContainer>
  <div class="shadow"></div>

  <form #editableFieldsForm="ngForm">
    <div *ngIf="picsLoaded$ | async" #profileContainer>
      <div class="shadow"></div>

      <div id="profile" style="display: flex">
        <app-profile-card
          #profileCard
          [isOwnProfile]="true"
          [profile]="currentUserStore.user$ | async"
          [profilePictures]="ownPicturesService.urls$ | async"
          [reportable]="false"
        ></app-profile-card>
      </div>

      <div #toggleDiv class="flexend">
        <nemo-toggle
          *ngIf="!(editingInProgress$ | async)"
          (choice)="toggleChange($event)"
          [buttonWidth]="15"
          [fontSize]="4"
          [selections]="['edit', 'view']"
        ></nemo-toggle>

        <nemo-toggle
          *ngIf="editingInProgress$ | async"
          (choice)="actOnProfileEditing($event)"
          [buttonWidth]="15"
          [fontSize]="4"
          [selections]="['save', 'cancel']"
        ></nemo-toggle>
      </div>
      <div
        id="editing"
        style="display: flex"
        *ngIf="currentUserStore.user$ | async as userProfile"
      >
        <div class="container">
          <h1>{{userProfile?.firstName}}, {{userProfile?.dateOfBirth | age}}</h1>

          <div 
          class="slide-button" 
          (click)="goToSettings()"
          [style.color]="(editingInProgress$ | async) 
            ? 'var(--ion-color-light-shade)'
            : 'var(--ion-color-light-contrast)'"
          >
            <p>Go to my settings</p>

            <ion-icon name="chevron-forward-outline"></ion-icon>
          </div>

          <h2>My photos</h2>
          <div class="photos">
            <app-profile-edit-photo
              *ngFor="let pics of ['','','','','','']; index as i"
              [url]="(ownPicturesService?.urls$ | async)[i]"
            ></app-profile-edit-photo>
          </div>
          <h2>My bio</h2>
          <div>
            <div #bioClose class="close-button" (click)="clearInput('bio')">
              <ion-icon name="close-outline"></ion-icon>
            </div>
            <div class="bio">
              <ion-textarea
                #bioInput
                name="biography"
                [(ngModel)]="editableFields.biography"
                (ngModelChange)="editingTriggered()"
                autoGrow="true"
                (ionInput)="displayExit('bio')"
              ></ion-textarea>
            </div>
          </div>

        <h2>My answers</h2>
        <profile-answer
          #answers
          *ngFor="let q of editableFields.questions; let i = index"
          [(questionAndAnswer)]="editableFields.questions[i]"
          (questionAndAnswerChange)="editingTriggered()"
          [questionsNotPicked]="questionsNotPicked"
        ></profile-answer>

        <ng-container *ngIf="this.answers">
          <div *ngIf="!reachedMaxQuestionsCount" class="flexcenter">
            <ion-icon
              id="addQuestion"
              name="add-circle"
              (click)="addQuestion()"
            ></ion-icon>
          </div>

            <div class="noQuestions" *ngIf="reachedMaxQuestionsCount">
              <span>Sorry, there's no space for any more questions!</span>
            </div>

            <!-- <div *ngIf="reachedMaxQuestionsCount" class="flexcenter">
              <ion-icon
                id="submitQuestion"
                name="checkmark-outline"
                (click)="submitQuestion()"
              ></ion-icon>
            </div> -->
          </ng-container>

          <h2>My course</h2>
          <profile-course
            #depts
            categoryPlaceHolder="Area of Study"
            name="courseFields"
            [categoryOptions]="areaOfStudyOptions"
            [(categoryChoice)]="editableFields.areaOfStudy"
            [(choice)]="editableFields.course"
            (categoryChoiceChange)="editingTriggered()"
            (choiceChange)="editingTriggered()"
          ></profile-course>

          <h2>My society</h2>
          <profile-course
            #socs
            categoryPlaceHolder="Society Category"
            name="societyFields"
            [categoryOptions]="societyCategoryOptions"
            [(categoryChoice)]="editableFields.societyCategory"
            [(choice)]="editableFields.society"
            (categoryChoiceChange)="editingTriggered()"
            (choiceChange)="editingTriggered()"
          ></profile-course>

          <h2>My interests</h2>
          <!--interests-slides
            name="interests"
            [interests]="editableFields?.interests"
            (interestsChange)="editingTriggered()"
            [listed]="false"
          ></interests-slides-->
          <div class="flexgrid">
            <div 
            class="interest"
            *ngFor="let interest of editableFields?.interests">
              <img [src]="getPicturePath(interest)"/>
            </div>
          </div>

          <div class="flexgrid">
            <ion-button class="intModal" (click)="presentIntModal()">Change</ion-button>
          </div>
        </div>
      </div>
    </div>
  </form>
</ion-content>
